/* @copyright Copyright 2024 United States Government as represented by the Administrator of the
              National Aeronautics and Space Administration.  All Rights Reserved. */

#define MODELS_10HZ   0.1

##include "sims/networks/example_space_vehicle/HarveyFluid.hh"
##include "sims/networks/example_space_vehicle/HarveyThermal.hh"
##include "sims/networks/example_space_vehicle/models/HarveySignal.hh"
##include "sims/networks/example_space_vehicle/ExamplePowerElect.hh"

// // Needed for sim bus multithreading
// #include "../S_modules/ChildThreadHandler.sm"
// #include "thread_safe_bus/thread_map.sm"

// // Simbus sim object
// #include "thread_safe_bus/simbus_simobj.sm"

// Default system classes
#include "sim_objects/default_trick_sys.sm"

// // Health and status sim object.
// #include "../S_modules/hs.sm"

#ifdef HLA
  #include "DistIf/THLA_interface.sm"
#endif

class HarveySimObject: public Trick::SimObject
{
    public:
        ExamplePowerElect  elect;   /**< (--) GUNNS fluid network */
        HarveySignal signal;
        HarveyFluid fluid;       /**< (--) GUNNS fluid network */
        HarveyThermal thermal;   /**< (--) GUNNS thermal network */
        HarveySimObject()
            :
            elect("harvey.elect"),
            signal(),
            fluid("harvey.fluid"),
            thermal("harvey.thermal")
        {
            ("initialization")      elect.initialize();
            ("initialization")      signal.initialize();
            ("initialization")      fluid.initialize();
            ("initialization")      thermal.initialize();

            ("restart")             elect.restart();
            ("restart")             fluid.restart();
            ("restart")             thermal.restart();

            // Main model updates
            P15 (MODELS_10HZ, "scheduled") elect.update(MODELS_10HZ);
            P25 (MODELS_10HZ, "scheduled") signal.update(MODELS_10HZ);
            P35 (MODELS_10HZ, "scheduled") fluid.update(MODELS_10HZ);
            P45 (MODELS_10HZ, "scheduled") thermal.update(MODELS_10HZ);

            // Data transfer jobs
            P20 (MODELS_10HZ, "scheduled") signal.pc.setVoltage(elect.loadSwitch6.mSwitch.getOutputVolts());
            P30 (MODELS_10HZ, "scheduled") fluid.pump.setMotorSpeed(signal.pc.getMotorSpeed());
            P30 (MODELS_10HZ, "scheduled") fluid.coldplate.setSegTemperature(0, thermal.coldplate.getTemperature());
            P40 (MODELS_10HZ, "scheduled") thermal.avionics.setExternalHeatFlux(0, harvey.elect.constantPowerLoad.getPowerDraw());
            P40 (MODELS_10HZ, "scheduled") thermal.coldplate.setExternalHeatFlux(0, fluid.coldplate.getTotalEnergyGain());
        }

        virtual ~HarveySimObject() { /* nothing to do */ }

    private:
        // Copy constructor unavailable since declared private and not implemented.
        HarveySimObject(const HarveySimObject&);
        // Assignment operator unavailable since declared private and not implemented.
        HarveySimObject operator = (const HarveySimObject&);
};


HarveySimObject harvey;
